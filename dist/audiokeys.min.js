!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.AudioKeys=e()}}(function(){return function e(t,i,o){function n(s,a){if(!i[s]){if(!t[s]){var y="function"==typeof require&&require;if(!a&&y)return y(s,!0);if(r)return r(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var _=i[s]={exports:{}};t[s][0].call(_.exports,function(e){var i=t[s][1][e];return n(i||e)},_,_.exports,e,t,i,o)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)n(o[s]);return n}({1:[function(e,t,i){t.exports={_addKey:function(e){const t=this._getIdentifier(e);var i=this;if(i._isNote(t)&&!i._isPressed(t)){var o=i._makeNote(t);i._state.keys=(i._state.keys||[]).concat(o),i._update()}else i._isSpecialKey(t)&&i._specialKey(t)},_removeKey:function(e){const t=this._getIdentifier(e);var i=this;if(i._isPressed(t)){for(var o,n=0;n<i._state.keys.length;n++){if(i._getIdentifier(i._state.keys[n])===t){o=i._state.keys[n];break}}i._state.keys.splice(i._state.keys.indexOf(o),1),i._update()}},_isPressed:function(e){var t=this;if(!t._state.keys||!t._state.keys.length)return!1;for(var i=0;i<t._state.keys.length;i++){if(t._getIdentifier(t._state.keys[i])===e)return!0}return!1},_makeNote:function(e){var t=this;const i={note:t._map(e),frequency:t._toFrequency(t._map(e)),velocity:t._state.velocity};return i[t._state.layoutIndependentMapping?"code":"keyCode"]=e,i},clear:function(){var e=this;e._state.buffer.forEach(function(t){t.velocity=0,e._trigger("up",t)}),e._state.keys=[],e._state.buffer=[]},_update:function(){var e=this,t=e._state.buffer;e._prioritize(),e._diff(t)},_diff:function(e){var t=this,i=e.map(t._getIdentifier.bind(t)),o=t._state.buffer.map(t._getIdentifier.bind(t)),n=[];i.forEach(function(e){-1===o.indexOf(e)&&n.push(e)});var r=[];o.forEach(function(e){-1===i.indexOf(e)&&r.push(e)}),r.forEach(function(e){for(var i=0;i<t._state.buffer.length;i++){if(t._getIdentifier(t._state.buffer[i])===e){t._trigger("down",t._state.buffer[i]);break}}}),n.forEach(function(i){for(var o=0;o<e.length;o++){if(t._getIdentifier(e[o])===i){e[o].velocity=0,t._trigger("up",e[o]);break}}})}}},{}],2:[function(e,t,i){t.exports={down:function(e){var t=this;t._listeners.down=(t._listeners.down||[]).concat(e)},up:function(e){var t=this;t._listeners.up=(t._listeners.up||[]).concat(e)},_trigger:function(e){var t=this;if(t._listeners[e]&&t._listeners[e].length){var i=Array.prototype.slice.call(arguments);i.splice(0,1),t._listeners[e].forEach(function(e){e.apply(t,i)})}},_bind:function(){var e=this;if("undefined"!=typeof window&&window.document){window.document.addEventListener("keydown",function(t){e._addKey(t)}),window.document.addEventListener("keyup",function(t){e._removeKey(t)});var t=!0;setInterval(function(){window.document.hasFocus()!==t&&((t=!t)||e.clear())},100)}}}},{}],3:[function(e,t,i){function o(e){var t=this;t._setState(e),t._keyMap=t._getKeyMap(t._state.layoutIndependentMapping),t._specialKeyMap=t._getSpecialKeyMap(t._state.layoutIndependentMapping),t._listeners={},t._bind()}var n=e("./AudioKeys.state"),r=e("./AudioKeys.events"),s=e("./AudioKeys.mapping"),a=e("./AudioKeys.buffer"),y=e("./AudioKeys.priority"),p=e("./AudioKeys.special");o.prototype._setState=n._setState,o.prototype._extendState=n._extendState,o.prototype.set=n.set,o.prototype.get=n.get,o.prototype.down=r.down,o.prototype.up=r.up,o.prototype._trigger=r._trigger,o.prototype._bind=r._bind,o.prototype._map=s._map,o.prototype._offset=s._offset,o.prototype._isNote=s._isNote,o.prototype._toFrequency=s._toFrequency,o.prototype._getIdentifier=s._getIdentifier,o.prototype._getKeyMap=s._getKeyMap,o.prototype._addKey=a._addKey,o.prototype._removeKey=a._removeKey,o.prototype._isPressed=a._isPressed,o.prototype._makeNote=a._makeNote,o.prototype.clear=a.clear,o.prototype._update=a._update,o.prototype._diff=a._diff,o.prototype._prioritize=y._prioritize,o.prototype._last=y._last,o.prototype._first=y._first,o.prototype._highest=y._highest,o.prototype._lowest=y._lowest,o.prototype._isSpecialKey=p._isSpecialKey,o.prototype._specialKey=p._specialKey,o.prototype._getSpecialKeyMap=p._getSpecialKeyMap,t.exports=o},{"./AudioKeys.buffer":1,"./AudioKeys.events":2,"./AudioKeys.mapping":4,"./AudioKeys.priority":5,"./AudioKeys.special":6,"./AudioKeys.state":7}],4:[function(e,t,i){t.exports={_map:function(e){return this._keyMap[this._state.rows][e]+this._offset()},_offset:function(){return this._state.rootNote-this._keyMap[this._state.rows].root+12*this._state.octave},_isNote:function(e){return!!this._keyMap[this._state.rows][e]},_toFrequency:function(e){return 440*Math.pow(2,(e-69)/12)},_getIdentifier:function(e){return e[this._state.layoutIndependentMapping?"code":"keyCode"]},_getKeyMap:function(e){return e?{1:{root:60,KeyA:60,KeyW:61,KeyS:62,KeyE:63,KeyD:64,KeyF:65,KeyT:66,KeyG:67,KeyY:68,KeyH:69,KeyU:70,KeyJ:71,KeyK:72,KeyO:73,KeyL:74,KeyP:75,SemiColon:76,Quote:77},2:{root:60,KeyZ:60,KeyS:61,KeyX:62,KeyD:63,KeyC:64,KeyV:65,KeyG:66,KeyB:67,KeyH:68,KeyN:69,KeyJ:70,KeyM:71,Comma:72,KeyL:73,Period:74,SemiColon:75,Slash:76,KeyQ:72,Digit2:73,KeyW:74,Digit3:75,KeyE:76,KeyR:77,Digit5:78,KeyT:79,Digit6:80,KeyY:81,Digit7:82,KeyU:83,KeyI:84,Digit9:85,KeyO:86,Digit0:87,KeyP:88,BracketLeft:89,Equal:90,BracketRight:91}}:{1:{root:60,65:60,87:61,83:62,69:63,68:64,70:65,84:66,71:67,89:68,72:69,85:70,74:71,75:72,79:73,76:74,80:75,186:76,222:77},2:{root:60,90:60,83:61,88:62,68:63,67:64,86:65,71:66,66:67,72:68,78:69,74:70,77:71,188:72,76:73,190:74,186:75,191:76,81:72,50:73,87:74,51:75,69:76,82:77,53:78,84:79,54:80,89:81,55:82,85:83,73:84,57:85,79:86,48:87,80:88,219:89,187:90,221:91}}}}},{}],5:[function(e,t,i){t.exports={_prioritize:function(){var e=this;if(!e._state.keys.length)return void(e._state.buffer=[]);e._state.polyphony>=e._state.keys.length?e._state.keys=e._state.keys.map(function(e){return e.isActive=!0,e}):(e._state.keys=e._state.keys.map(function(e){return e.isActive=!1,e}),e["_"+e._state.priority]()),e._state.buffer=[],e._state.keys.forEach(function(t){t.isActive&&e._state.buffer.push(t)})},_last:function(){for(var e=this,t=e._state.keys.length-e._state.polyphony;t<e._state.keys.length;t++)e._state.keys[t].isActive=!0},_first:function(){for(var e=this,t=0;t<e._state.polyphony;t++)e._state.keys[t].isActive=!0},_highest:function(){var e=this,t=e._state.keys.map(function(e){return e.note});t.sort(function(e,t){return t===e?0:t<e?-1:1}),t.splice(e._state.polyphony,Number.MAX_VALUE),e._state.keys.forEach(function(e){-1!==t.indexOf(e.note)&&(e.isActive=!0)})},_lowest:function(){var e=this,t=e._state.keys.map(function(e){return e.note});t.sort(function(e,t){return e===t?0:e<t?-1:1}),t.splice(e._state.polyphony,Number.MAX_VALUE),e._state.keys.forEach(function(e){-1!==t.indexOf(e.note)&&(e.isActive=!0)})}}},{}],6:[function(e,t,i){t.exports={_isSpecialKey:function(e){return 1===this._state.rows&&this._specialKeyMap[e]},_specialKey:function(e){var t=this;"octave"===t._specialKeyMap[e].type&&t._state.octaveControls?t._state.octave+=t._specialKeyMap[e].value:"velocity"===t._specialKeyMap[e].type&&t._state.velocityControls&&(t._state.velocity=t._specialKeyMap[e].value)},_getSpecialKeyMap:function(e){return e?{KeyZ:{type:"octave",value:-1},KeyX:{type:"octave",value:1},Digit1:{type:"velocity",value:1},Digit2:{type:"velocity",value:14},Digit3:{type:"velocity",value:28},Digit4:{type:"velocity",value:42},Digit5:{type:"velocity",value:56},Digit6:{type:"velocity",value:70},Digit7:{type:"velocity",value:84},Digit8:{type:"velocity",value:98},Digit9:{type:"velocity",value:112},Digit0:{type:"velocity",value:127}}:{90:{type:"octave",value:-1},88:{type:"octave",value:1},49:{type:"velocity",value:1},50:{type:"velocity",value:14},51:{type:"velocity",value:28},52:{type:"velocity",value:42},53:{type:"velocity",value:56},54:{type:"velocity",value:70},55:{type:"velocity",value:84},56:{type:"velocity",value:98},57:{type:"velocity",value:112},48:{type:"velocity",value:127}}}}},{}],7:[function(e,t,i){t.exports={_setState:function(e){var t=this;e||(e={}),t._state={},t._extendState({polyphony:4,rows:1,priority:"last",rootNote:60,octaveControls:!0,octave:0,velocityControls:!0,velocity:127,keys:[],buffer:[],layoutIndependentMapping:!1}),t._extendState(e)},_extendState:function(e){var t=this;for(var i in e)t._state[i]=e[i]},set:function(){var e=this;return 1===arguments.length?e._extendState(arguments[0]):e._state[arguments[0]]=arguments[1],this},get:function(e){return this._state[e]}}},{}]},{},[3])(3)});